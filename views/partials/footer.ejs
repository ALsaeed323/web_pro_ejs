<footer class="text-center">Copyright Spring 2023 The Awesome SWE230</footer>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

<script>
  const redirect = async (link) => {
    window.location.href = link;
  };
  const addToCartHandler = async (productId) => {
    const fet = await fetch("/cart/add", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ id: productId }),
    });

    if (fet.status === 200) {
      window.location.reload();
    }
  };
  const signinHandler = async (e) => {
    e.preventDefault();
    const email = document.getElementById("signinEmail").value;
    const password = document.getElementById("signinPassword").value;
    const response = await fetch("/user/signin", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ email, password }),
    });

    if (response.status === 200) {
      window.location.href = "/";
    } else {
      const data = await response.json(); // extract the body data
      console.log(data);
      displayErrorMessage('emailErrorMessage','Invalid email');

    }
  };
  const signupHandler = async (e) => {
    e.preventDefault();
    const name = document.getElementById("signupName").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;
    const confimPassword = document.getElementById(
      "signupConfirmPassword"
    ).value;
    if (password !== confimPassword) {
      displayErrorMessage('passwordErrorMessage','Password and Confirm Password do not match');
      return;
    }
    const response = await fetch("/user/signup", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ name, email, password }),
    });
    if (response.status === 200) {
      window.location.href = "/";
    } else if (response.status === 409) {
      displayErrorMessage('emailErrorMessage','ُEmail already exist');
    } else {
      const data = await response.json(); // extract the body data
      console.log(data);
      displayErrorMessage('emailErrorMessage','something went wrong');
    }
  };
  const signoutHandler = (e) => {
    e.preventDefault();
    fetch("/user/logout", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    }).then((res) => {
      if (res.status === 200) {
        if(window.location.href === "/"){
          location.reload();
        }
        else{
          window.location.href = "/";
        }
      } else {
        console.log("Failed to sign out");
      }
    });
  };
  const searchHandler = (e) => {
    e.preventDefault();
    const q = document.getElementById("q").value;
    window.location.href = `/products/search?query=${q}`;
  };
  const shippingHandler = async (e) => {
    e.preventDefault();
    const data = {
      fullName: document.getElementById("shippingFullName").value,
      address: document.getElementById("shippingAddress").value,
      city: document.getElementById("shippingCity").value,
      postalCode: document.getElementById("shippingPostalCode").value,
      country: document.getElementById("shippingCountry").value,
    };
    const resposnce = await fetch("/user/shipping", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });
    redirect("/payment");
  };
  const paymentHandler = async (e) => {
    e.preventDefault();
    const data = {
      paymentMethod: document.getElementById("paymentForm").paymentMethod.value,
    };
    const resposnce = await fetch("/user/payment", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });
    redirect("/placeorder");
  };
  const placeOrderHandler = async (e) => {
    e.preventDefault();
    const data = {
      orderItems: cart,
      itemsPrice,
      shippingPrice,
      taxPrice,
      totalPrice,
      user,
    };
    const resposnce = await fetch("/orders", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });
    if (resposnce.status === 200) 
    {
      const res = await resposnce.json();
      console.log(res);
      window.location.href = `/orders/${res.id}`;
    }
  };
  const profileHandler = async (e) => {
    e.preventDefault();
    const name= document.getElementById("profileName").value;
    const email= document.getElementById("profileEmail").value;
    const password = document.getElementById("profilePassword").value;
    const confimPassword = document.getElementById("profileConfirmPassword").value;
    if (password !== confimPassword) {
      displayErrorMessage('passwordErrorMessage','Password and Confirm Password do not match');
      return;
    }
    const data = { name, email, password    };
    const resposnce = await fetch("/user/profile", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });
    window.location.href = `/`;
  };
  const deleteUserHandler = async (e,id) => {
    e.preventDefault();
    const resposnce = await fetch(`/admin/user/${id}`, {
      method: "DELETE",
    });
    if(resposnce.status === 200)
    {
      showMessage("User Deleted");
      window.location.reload();
    }
    else{
      showMessage("Something went wrong");

    }
  };

</script>
